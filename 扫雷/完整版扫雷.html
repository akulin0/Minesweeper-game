<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
        <style>
            .row{
                width: 216px;
                height: 215px;
                border: 1px solid gainsboro;
                position: relative;
                left: 40%;
                text-align: center;
            }
            .clearfix {
                content: " ";
                display: block;
                clear: both;
            }
            .cell {
                width: 20px;
                height: 20px;
                background: #9e9e9e;
                border: 2px solid gainsboro;
                float: left;
            }
            .hide {
                /*line-height:0;*/
                font-size:0;
                /*overflow:hidden;*/

            }
            .pattern {
                /*display: flex;*/
                float: left;
                left: 40%;
                position: relative;
                width: 216px;
            }
            .start:hover{
                cursor:pointer;
            }
            .flag {
                background-image: url("flag.jpeg");
                content: 'ğŸš©';

            }
            .start {
                flex: 1 1 auto;
                margin: 5px;
                padding: 5px;
                border: 1px solid white;
                text-align: center;
                position: relative;
                overflow: hidden;
                transition: 0.3s;
                top: 0;
            }
            .sta:after {
                position: absolute;
                transition: 0.3s;
                content: "";
                width: 0;
                left: 50%;
                bottom: 0;
                height: 3px;
                background: #9e9e9e;
            }
            .sta:hover {
                cursor: pointer;
            }
            .sta:hover:after {
                width: 100%;
                left: 0;
            }
            .time {
                position: absolute;
                display: inline;
                border: 1px solid white;
                text-align: center;
                transition: 0.3s;
                /*flex: auto;*/
                margin: 5px;
                padding: 5px;
                left: 65%;
                bottom: 0;
            }
            .Time {
                position: absolute;
                left: 89%;
                top: 24%;
            }
            .colour {
                background: white;
            }
            .text-colour {
                color: #1198ff;
            }
        </style>
    </head>
    <body>
        <div class="pattern">
            <button class="sta start">é‡æ–°å¼€å§‹</button>
            <button class="sta time" data-id="0" data-nubmer="0">è®¡æ—¶: </button>
            <div class="Time"></div>
            <br>
        </div>
        <div class="row clearfix">
        </div>
        <script>
            // 1. templateCell å‡½æ•°, å‚æ•°ä¸ºæ•°ç»„ line å’Œå˜é‡ x
            // line æ˜¯æ¯ä¸€è¡Œçš„æ•°ç»„
            // æ¯”å¦‚ç¬¬ä¸€è¡Œå°±æ˜¯ | 9 | 1 | 0 | 0 | 0 | 1 | 1 | 1 | 0 |
            // x è¡¨ç¤ºç¬¬å‡ è¡Œ
            // è¿™ä¸ªå‡½æ•°è¿”å› line.length ä¸ª cell æ‹¼æ¥çš„å­—ç¬¦ä¸²
            let math = 0
            const log = console.log.bind(console)
            // let s = '[[9,1,0,0,0,1,1,1,0],[1,1,0,0,1,2,9,1,0],[1,1,1,0,1,9,2,1,0],[1,9,2,1,1,1,1,0,0],[1,2,9,1,0,0,1,1,1],[1,2,1,1,0,1,2,9,1],[9,1,0,0,1,2,9,2,1],[1,2,1,1,1,9,2,1,0],[0,1,9,1,1,1,1,0,0]]'
            let s = '[[9,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,9,0,0],[0,0,0,0,0,9,0,0,0],[0,9,0,0,0,0,0,0,0],[0,0,9,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0],[9,0,0,0,0,0,9,0,0],[0,0,0,0,0,9,0,0,0],[0,0,9,0,0,0,0,0,0]]'
            let square = JSON.parse(s)

            const e = function(selector) {
                let element = document.querySelector(selector)
                if (element === null) {
                    let s = `é€‰æ‹©å™¨ ${selector} å†™é”™äº†, è¯·ä»”ç»†æ£€æŸ¥å¹¶ä¸”å¤ä¹ ä¸‰ç§åŸºæœ¬çš„é€‰æ‹©å™¨`
                    alert(s)
                    return null
                } else {
                    return element
                }
            }

            const es = function(selector) {
                let elements = document.querySelectorAll(selector)
                if (elements.length === 0) {
                    let s = `é€‰æ‹©å™¨ ${selector} å†™é”™äº†, è¯·ä»”ç»†æ£€æŸ¥å¹¶ä¸”å¤ä¹ ä¸‰ç§åŸºæœ¬çš„é€‰æ‹©å™¨`
                    alert(s)
                    return []
                } else {
                    return elements
                }
            }

            const insert = (s) => {
                let time = e('.Time')
                let t = `
                <span>${s}</span>
                `
                time.innerHTML = t
            }

            const demoTime = () => {
                let time = e('.time')
                let id = parseInt(time.dataset.nubmer)
                // log("id", id)
                let clockId = setInterval(function() {
                    s = id + 1
                    // log("å¼€å§‹", s)
                    insert(s)
                    id = s
                }, 1000)
                time.dataset.id = String(clockId)
                return clockId
            }

            const shut_ = () => {
                let time = e('.time')
                let id = time.dataset.id
                parseInt(id, 10)
                window.addEventListener('onbeforeunload', function() {
                    clearInterval(id)
                })
                time.addEventListener('click', function(event) {
                    // let self = event.target
                    log("ç‚¹å‡»åˆ°", id)
                    clearInterval(id)
                })
            }

            const star = function() {
                let st = e(".start")
                st.addEventListener('click', function(event) {
                    location.reload()
                })
            }

            const shuffle = function(array) {
                let random = 0
                let newarr = []
                while (array.length) {
                    random = Math.floor(Math.random() * array.length)
                    newarr.push(array[random])
                    array.splice(random, 1)
                }
                // log("return", newarr)
                return newarr
            }

            //å¤„ç†éšæœºæ•°ä»¥åçš„æ•°å­—
            const push_1 = function (square, i, j) {
                let n = square.length
                // array[x][y] ä¸èƒ½æ˜¯ 9
                // ä¸‹æ ‡ä¸èƒ½è¶Šç•Œ
                if (i >= 0 && i < n && j >= 0 && j < n) {
                    if (square[i][j] !== 9) {
                        square[i][j] += 1
                    }
                }
            }

            const markAround = function (square, i, j) {
                //æ ‡è®°å‘¨å›´8ä¸ªç‚¹
                if (square[i][j] === 9) {
                    //zuo
                    push_1(square, i - 1,j - 1)
                    push_1(square, i - 1, j)
                    push_1(square, i - 1,j + 1)
                    //ä¸­2ä¸ª
                    push_1(square, i,j - 1)
                    push_1(square, i,j + 1)
                    //
                    push_1(square, i + 1,j - 1)
                    push_1(square, i + 1,j)
                    push_1(square, i + 1,j + 1)
                }
            }

            const clonedSquare = function(array) {
                let new_array = []
                for (let i = 0; i < array.length; i++) {
                    new_array.push(array[i].slice(0))
                }
                return new_array
            }

            const markedSquare = function(array) {
                let square = clonedSquare(array)
                for (let i = 0; i < square.length; i++) {
                    let line = square[i]
                    for (let j = 0; j < line.length; j++) {
                        markAround(square, i, j)
                    }
                }
                return square
            }

            const removeAll = function(active) {
                let s = '.' + active
                let array = es(s)
                for (let i = 0; i < array.length; i++) {
                    array[i].classList.remove(active)
                    array[i].classList.add('colour')
                }
            }

            const removeflag = function(active) {
                let s = '.' + active
                let array = es(s)
                for (let i = 0; i < array.length; i++) {
                    array[i].classList.remove(active)
                }
            }

            const templateCell = function(line, x) {
                let result = ''
                for (let i = 0; i < line.length; i++) {
                    result += `<div class="cell hide" data-number=${line[i]} data-x=${x} data-y=${i}>${line[i]}</div>`
                }
                return result
            }

            // 2. templateRow çš„å‚æ•° square æ˜¯äºŒç»´æ•°ç»„
            // ç”¨æ¥è¡¨ç¤ºé›·ç›¸å…³çš„æ•°æ®, æˆ‘ä»¬è¿™é‡Œæ˜¯ç›´æ¥å†™æ­»çš„æ•°æ®
            // è¿”å› square.length ä¸ª row æ‹¼æ¥çš„å­—ç¬¦ä¸²
            // row çš„å†…å®¹ç”± templateCell å‡½æ•°ç”Ÿæˆ
            const templateRow = function(square) {
                let result = ''
                for (let i = 0; i < square.length; i++) {
                    result += templateCell(square[i], i)
                }
                return result
            }

            // 3. square æ˜¯äºŒç»´æ•°ç»„, ç”¨æ¥è¡¨ç¤ºé›·ç›¸å…³çš„æ•°æ®
            // ç”¨ square ç”Ÿæˆ 9 * 9 çš„æ ¼å­, ç„¶åæ’å…¥åˆ°é¡µé¢ä¸­
            // div container æ˜¯ <div id="id-div-mime"></div>
            const renderSquare = function(square) {
                let row = e(".row.clearfix")
                row.insertAdjacentHTML('beforeend', templateRow(square))
            }

            // 4. å®ç° bindEventDelegate å‡½æ•°
            // ç”¨äº‹ä»¶å§”æ‰˜çš„å½¢å¼åœ¨çˆ¶å…ƒç´ ä¸Šé¢ç»‘å®š click äº‹ä»¶, åªå¤„ç†æ ¼å­
            // ä¹Ÿå°±æ˜¯ .cell(å³ class åŒ…å« cell å­—ç¬¦ä¸²) å…ƒç´ 
            // å¦‚æœç‚¹å‡»çš„æ˜¯ .cell å…ƒç´ , é‚£ä¹ˆè°ƒç”¨ vjkl å‡½æ•°
            // æ³¨æ„, æˆ‘ä»¬åœ¨ bindEventDelegate é‡Œé¢ä¸å¤„ç†å…·ä½“çš„é€»è¾‘, åªè°ƒç”¨å‡½æ•°
            // å…·ä½“é€»è¾‘æ”¾åœ¨ vjkl å‡½æ•°é‡Œé¢å®ç°
            const bindEventDelegate = function(square) {
                let rows = es(".cell")
                for (let i = 0; i < rows.length; i++) {
                    rows[i].remove()
                }
            }

            // 5. vjkl æ˜¯ç‚¹å‡»æ ¼å­åæ‰§è¡Œçš„å‡½æ•°, æˆ‘ä»¬éœ€è¦æŠŠæ‰«é›·çš„é€»è¾‘å†™åœ¨è¿™ä¸ªå‡½æ•°ä¸­
            // è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬åœ¨åˆå§‹æƒ…å†µä¸‹å°±æŠŠæ•°å­—å†™åˆ°äº† html ä¸­
            // <div class="cell" data-number="1" data-x="0" data-y="1">1</div>
            // è€Œåˆå§‹æƒ…å†µä¸‹æ•°å­—ä¸åº”è¯¥æ˜¾ç¤ºå‡ºæ¥çš„, å¯ä»¥ç›´æ¥ç”¨ font-size: 0; æ¥éšè—æ–‡å­—
            // ç‚¹å‡»çš„æ—¶å€™æ ¹æ®æƒ…å†µç”¨ font-size: 14px; çš„æ–¹å¼æ˜¾ç¤ºæ–‡å­—
            // å½“ç„¶è¿™ä¸€æ­¥åº”è¯¥ç”¨ class æ¥å®Œæˆ, æ¯”å¦‚ opened class é‡Œé¢å†™ font-size: 14px;
            // ç‚¹å‡»çš„æ—¶å€™æ ¹æ® class æ¥æ‰§è¡Œå…·ä½“é€»è¾‘
            // å¦‚æœå·²ç»æ˜¾ç¤ºè¿‡(ä¹Ÿå°±æ˜¯ class åŒ…å« opened), åˆ™ä¸åšä»»ä½•å¤„ç†
            // å¦‚æœæ²¡æœ‰æ˜¾ç¤ºè¿‡(ä¹Ÿå°±æ˜¯ class ä¸åŒ…å« opened), åˆ¤æ–­ä¸‹åˆ—æƒ…å†µ
            // 1. å‡è®¾ç‚¹å‡»çš„æ˜¯æ•°å­— 9, å±•å¼€, æ¸¸æˆç»“æŸ
            // 2. å‡è®¾ç‚¹å‡»çš„æ˜¯æ•°å­— 0
            // æ­¤æ—¶éœ€è¦å±•å¼€ 0 å‘¨å›´çš„ä¸€ç‰‡, é€šè¿‡è°ƒç”¨ vjklAround å‡½æ•°æ¥å®Œæˆ
            // ä¹Ÿå°±æ˜¯è¯´ä¾ç„¶æŠŠé€»è¾‘å†™åœ¨ä¸‹ä¸€å±‚å‡½æ•° vjklAround ä¸­
            // 3. å‡è®¾ç‚¹å‡»çš„æ˜¯å…¶ä»–æ•°å­—, å±•å¼€
            const vjkl = function(cell, square) {
                let row = e(".row.clearfix")
                let number = 0
                let stochastic = shuffle(square)
                let st = markedSquare(stochastic)
                if (cell !== null) {
                    let seek = e(`[data-x="${cell[0]}"][data-y="${cell[1]}"]`)
                    if (seek.dataset.number === '0') {
                        seek.classList.remove('hide')
                        seek.classList.add('colour')
                        seek.classList.remove('flag')
                        math += 1
                        vjklAround(stochastic, cell[0], cell[1])
                    } else if (seek.dataset.number === '9'){
                        // log("ç¬¬äºŒæ¬¡ç‚¹å‡»åˆ°9",)
                        bindEventDelegate(stochastic)
                        renderSquare(st)
                        let b = cell[0] + cell[1]
                        return vjkl(b, stochastic)
                    } else {
                        log("else1")
                        seek.classList.remove("hide")
                        seek.classList.add('colour')
                        // seek.classList.remove('flag')
                        math += 1
                    }
                }

                row.addEventListener('click', function(event) {
                    let self = event.target
                    let value = self.dataset.number
                    let x = self.dataset.x
                    let y = self.dataset.y
                    number += 1

                    if (!self.classList.contains("hide")) {
                        // log("å±•å¼€è¿‡äº†")
                    } else {
                        if (number === 1) {
                            if (value === '9') {
                                // log("ç¬¬ä¸€æ¬¡ç‚¹å‡»åˆ°9",)
                                bindEventDelegate(square)
                                renderSquare(st)
                                let b = [x] + [y]
                                return vjkl(b, stochastic)
                            }
                        }
                        if (value === '9') {
                            mine_()
                            removeAll("hide")
                            if (row.querySelector(".flag")) {
                                removeflag("flag")
                            }

                        } else if (value === '0') {
                            // self.classList.remove('hide')
                            // log("else if 0", )
                            vjklAround(stochastic, x, y)

                        } else {
                            // log('else')
                            self.classList.remove('hide')
                            self.classList.add('colour')
                            self.classList.remove('flag')
                            math += 1
                        }
                    }
                    log('math', math)
                    if (math === 71) {
                        alert('æ­å–œæˆåŠŸé€šå…³ï¼Œæˆªå›¾é¢†å–ä¸€ç“¶å†·é¥®ï¼')
                    }
                })
            }

            const replace = () => {
                let row = es(".cell")
                for (let i = 0; i < row.length; i++) {
                    let number = row[i].dataset.number
                    if (number === '0') {
                        row[i].innerHTML = ' '
                    } else if (number === '9') {
                        row[i].innerHTML = 'ğŸ’£'
                    } else {
                        row[i].classList.add('.text-colour')
                    }
                }
            }

            // 6. vjklAround å±•å¼€å‘¨å›´ cell å‘¨å›´ 8 ä¸ªå…ƒç´ ,
            // x å’Œ y åˆ†åˆ«æ˜¯ä¸‹æ ‡
            // å±•å¼€å‘¨å›´çš„å…ƒç´ é€šè¿‡è°ƒç”¨ vjkl1 æ¥è§£å†³
            // æ³¨æ„, ä¾ç„¶æŠŠé€»è¾‘æ”¾åœ¨ä¸‹ä¸€å±‚æ¥å¤„ç†
            const vjklAround = function(square, x, y) {
                x = parseInt(x, 10)
                y = parseInt(y, 10)

                vjkl1(square, x - 1, y - 1)
                vjkl1(square, x - 1, y)
                vjkl1(square, x - 1, y + 1)
                //ä¸­é—´ä¸¤ä¸ª
                vjkl1(square, x, y - 1)
                vjkl1(square, x, y)
                vjkl1(square, x, y + 1)
                //ä¸‹é¢ä¸‰ä¸ª
                vjkl1(square, x + 1, y - 1)
                vjkl1(square, x + 1, y)
                vjkl1(square, x + 1, y + 1)
            }

            // 7. vjkl1 æ˜¯é‡ç‚¹å‡½æ•°
            // å¦‚æœæ»¡è¶³è¾¹ç•Œè°ƒèŠ‚, åˆ™ç»§ç»­
            // æ»¡è¶³è¾¹ç•Œçš„æ„æ€æ˜¯ä¸‹æ ‡ç¬¦åˆèŒƒå›´
            // å› ä¸º vjkl1 è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å±•å¼€æ ¼å­, æ‰€ä»¥å¦‚æœå·²ç»å±•å¼€è¿‡, é‚£ä¹ˆå°±ä¸å±•å¼€å…ƒç´ 
            // æ ¹æ® x å’Œ y è¿˜æœ‰å±æ€§é€‰æ‹©å™¨é€‰æ‹©å‡ºæ ¼å­, å…·ä½“å¯ä»¥å‚è€ƒ
            // https://developer.mozilla.org/zh-CN/docs/Web/CSS/Attribute_selectors
            // æ¯”å¦‚æƒ³é€‰ä¸­ data-x=3 çš„å…ƒç´ , è¯­æ³•æ˜¯ e('[data-x="3"]')
            // æ¯”å¦‚æƒ³åŒæ—¶é€‰ä¸­ data-x=3 ä¸” data-y=5 çš„å…ƒç´ , è¯­æ³•æ˜¯ e('[data-x="3"][data-y="5"]')
            // é€‰æ‹©å…ƒç´ ä¹‹åæ ¹æ®æƒ…å†µæ¥åˆ¤æ–­
            // å¦‚æœæ²¡æœ‰å±•å¼€è¿‡, ç»§ç»­åˆ¤æ–­ä¸‹åˆ—æƒ…å†µ
            // å¦‚æœç¢°åˆ°çš„æ˜¯ 0, å±•å¼€, å¹¶ä¸”é€’å½’è°ƒç”¨ vjklAround å‡½æ•°
            // å¦‚æœç¢°åˆ°çš„æ˜¯å…¶ä»–å…ƒç´ , å±•å¼€
            const vjkl1 = function(square, x, y) {
                // let x1 = 'data-x' + '=' + `"${x}"`
                // let y1 = 'data-y' + '=' + `"${y}"`
                // let z = e(`[${x1}][${y1}]`)
                let s = square.length
                if (x >= 0 && x < s && y >= 0 && y < s) {
                    let z = e(`[data-x="${x}"][data-y="${y}"]`)
                    if (z.classList.contains("hide")) {
                        math += 1
                        if (z.dataset.number === '0') {
                            z.classList.remove("hide")
                            replace()
                            z.classList.add('colour')
                            z.classList.remove("flag")
                            vjklAround(square, x, y)
                        } else {
                            z.classList.remove("hide")
                            z.classList.remove("flag")
                            z.classList.add('colour')
                        }
                    }
                }
            }

            const mouse = function() {
                let whole = e('.row.clearfix')
                whole.addEventListener('contextmenu', function(event) {
                    event.preventDefault()
                    let self = event.target
                    if (self.classList.contains('hide')) {
                        self.classList.toggle('flag')
                    }
                })

                whole.addEventListener('click', function(Event) {
                    let self = Event.target
                    if (self.classList.contains('flag')) {
                        Event.stopPropagation()
                    }
                }, true)
            }

            const mine_ = function() {
                let row = e(".row.clearfix")
                let vs = row.querySelectorAll('.hide')
                for (let i = 0; i < vs.length; i++) {
                    if (vs[i].dataset.number === '9') {
                        vs[i].classList.add('mine')
                        replace()
                    }
                }
            }

            const _main = function() {
                let stochastic = shuffle(square)
                let st = markedSquare(stochastic)
                renderSquare(st)
                vjkl(null, stochastic)
                star()
                mouse()
                demoTime()
                shut_()
                // replace()
            }
            _main()
        </script>
    </body>
</html>